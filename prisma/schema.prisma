// schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// =============== Enum ===============
enum PaymentStatus {
  PENDING
  SUCCESS
  FAILED
}

enum Role {
  ADMIN
  SUPER_ADMIN
}

// =============== Category ===============
model Category {
  id        String   @id @default(uuid()) @db.Uuid
  name      String
  slug      String   @unique
  image     String?
  
  products  Product[]
  
  createdAt DateTime @default(now()) @db.Timestamp()
  updatedAt DateTime @updatedAt @db.Timestamp()
}

// =============== Product ===============
model Product {
  id          String   @id @default(uuid()) @db.Uuid
  categoryId  String   @db.Uuid
  category    Category @relation(fields: [categoryId], references: [id])

  name        String
  description String?  @db.Text
  price       Decimal  @db.Decimal(10, 2)
  image       String?
  isActive    Boolean  @default(true)

  // Relations
  stocks      ProductStock[]
  orderItems  OrderItem[]

  createdAt   DateTime @default(now()) @db.Timestamp()
  updatedAt   DateTime @updatedAt @db.Timestamp()
}

model ProductStock {
  id        String   @id @default(uuid()) @db.Uuid
  productId String   @db.Uuid
  product   Product  @relation(fields: [productId], references: [id])

  content   String   @db.Text

  isSold    Boolean  @default(false) 
  soldAt    DateTime? @db.Timestamp()

  orderItemId String?    @unique @db.Uuid
  orderItem   OrderItem? @relation(fields: [orderItemId], references: [id])

  createdAt DateTime @default(now()) @db.Timestamp()
  updatedAt DateTime @updatedAt @db.Timestamp()
  
  @@index([productId, isSold])
}

// =============== Order ===============
model Order {
  id              String        @id @default(uuid()) @db.Uuid
  customerContact String
  totalPrice      Decimal       @db.Decimal(10, 2)
  
  paymentStatus   PaymentStatus @default(PENDING)
  paymentProof    String?

  items           OrderItem[]

  createdAt       DateTime      @default(now()) @db.Timestamp()
  updatedAt       DateTime      @updatedAt @db.Timestamp()
}

model OrderItem {
  id        String  @id @default(uuid()) @db.Uuid
  orderId   String  @db.Uuid
  order     Order   @relation(fields: [orderId], references: [id])

  productId String  @db.Uuid
  product   Product @relation(fields: [productId], references: [id])
  
  price     Decimal @db.Decimal(10, 2)

  stock     ProductStock?
  
  createdAt DateTime @default(now()) @db.Timestamp()
}

// =============== User ===============
model User {
  id        String   @id @default(uuid()) @db.Uuid
  username  String   @unique
  password  String
  role      Role     @default(ADMIN)
  isActive  Boolean  @default(true)

  createdAt DateTime @default(now()) @db.Timestamp()
  updatedAt DateTime @updatedAt @db.Timestamp()
  deletedAt DateTime? @db.Timestamp()
}

